# U5 - Componentes de un computador: Entrada/Salida

# Modulo de E/S
![es](https://github.com/user-attachments/assets/c4ab9d42-27f7-4853-833d-37454298d2a6) <br>

## ¬øPor que existe?
Porque cada periferico tiene formas de comunicacion, formas de transferencias de datos, tecnologia, velocidad de transferencia de informacion, etc, distintas, entonces el modulo E/S lidia con esa complejidad para que no lo tenga que hacer el CPU.
- Amplia variedad de perif√©ricos con distintos m√©todos de operaci√≥n
- La tasa de transferencia de los perif√©ricos es generalmente mucho m√°s lenta que la de la memoria y procesador
- Los perif√©ricos usan distintos formatos de datos y tama√±os de palabra
## ¬øPara que sirve?
Oculta detalles de timing, formatos y electro mec√°nica de los dispositivos perif√©ricos
## ¬øQue hace?
Conecta a los perif√©ricos con la CPU y la memoria a trav√©s del bus del sistema o switch central y permite la comunicaci√≥n entre ellos. <br>
Lo que va a intercambia el modulo E/S con los perifericos son datos, informacion de control y el estado de los perifericos (ej una impresora que se le trabo el papel).

![es](https://github.com/user-attachments/assets/b9143982-8164-4ab2-9cc5-31ebe040d432) <br>

# Funciones 
- **Control y Timing:** controla el flujo de trafico entre CPU/Memoria y perifericos. Todo el tiempo controla el flujo de informacion (ej. transmision inalambrica constante de un audio captado por un microfono).
- **Comunicacion con el procesador:**
    * Decodificacion de comandos: un comando generico se traduce en comandos especificos para el procesador.
    * Datos: se transmiten datos desde el CPU al periferico (ej. imprimir una imagen: la imagen viaja en forma de byte a traves de la E/S, a traves de la forma que tenga de comunicarse con la impresora (inalambrico o por cable) y llegan los bytes que componen la imagen hasta la impresora).
    * Informacion de estado: el CPU puede leer el estado de un periferico.
    * Reconocimiento de direcciones: todos los perifericos conectados tienen un ID unico entonces el CPU sabe que ID usar para comunicarse con ese periferico.
- **Comunicacion con el dispositivo:** que intercambia el modulo E/S con el dispositivo
    * Comandos: por ejemplo, a un disco rigido le puede llegar la directiva de grabar tal conjunto de bytes en tal posicion del disco. O decirle a una impresora que imprima tal imagen que esta en una direccion de memoria.
    * Informacion de estado: 
    * Datos: por ej un teclado envia que tecla se presiono.
- **Buffering de datos:** refiere al resguardo de datos temporal para transmitirlos en el momento adecuado. Es el proceso de almacenar temporalmente datos en un √°rea de memoria conocida como "buffer" antes de que sean procesados o transmitidos. Este almacenamiento temporal permite manejar diferencias en las tasas de procesamiento entre dos entidades que producen y consumen los datos, como puede ser entre un dispositivo de entrada/salida y el CPU
- **Deteccion de errores:** tiene que ver con la trasmision del estado. El modulo E/S detecta si hay una codicion de error.

# Estructura del modulo E/S
![esq](https://github.com/user-attachments/assets/45c982a8-9db6-4619-9430-e38d6c238408) <br>

- **I/O logic:** controla la transferencia de datos entre los registros internos y el bus del sistema, y entre los registros internos y los perifericos.
- **External device interface logic:** se refiere a la logica de cada periferico al que el modulo E/S le da servicio. Aseguran que los datos se transfieran correctamente y que se respeten los protocolos de comunicacion de cada periferico.
## Interface Interna (bus del sistema)
- **Data lines:** transmite datos entre el procesador y el modulo de E/S. Camino electronico, linea de comunicacion con el CPU y Memoria. Se guardan temporalmente los datos que le quiere mandar el CPU al periferico para que haga algo: *data registers* es el buffer de datos y *status/control registers* guarda momentaneamente parametros adicionales de los comandos que se envian y el estado que el periferico envia
- **Address lines:** lo que intercambia el CPU con el modulo de E/S es el reconocimiento de perifericos a traves de su ID.
- **Control lines:** viaja el comando que el CPU envia de forma generica y el *I/O logic* lo interpreta y lo procesa para que se decodifique para cada periferico.
## Interface Externa (perifericos):
- **Data:** transmite datos entre el m√≥dulo de E/S y los perif√©ricos. Camino electronico hacia la interfaz externa con los dispositivos
- **Status:** proporciona informaci√≥n sobre el estado de los perif√©ricos, como listo para recibir datos, ocupado, etc. El periferico manda el estado.
- **Control:** permite al procesador enviar comandos a los perif√©ricos, como iniciar una operaci√≥n, detenerla, etc. El comando traducido se envia al periferico.

## Tecnicas para operaciones de E/S

## E/S Programada
![a](https://github.com/user-attachments/assets/d21f9125-7558-4b4f-bf17-bf9299d8c7ca)

### Como funciona cuando un programa esta realizando una operacion de entrada y salida:
1. Un comando generico va desde el CPU hasta el periferico pasando a traves del modulo E/S
2. El CPU se queda esperando una respuesta. `I/O -> CPU`
3. Recibe como respuesta el estado del periferico:
    * Puede no estar listo para recibir el comando (por ej esta terminando otra tarea previa) y el CPU vuelve a quedarse esperando una respuesta. Regresa al paso 2.
    * Puede recibir una condicion de error y derivarse a alguna accion particular.
    * Puede recibir un estado que indique que esta listo. Va al paso 4

A partir de aca significa que el modulo E/S envio la peticion, el periferico la recibio, la realizo y le devolvio la informacion que el CPU queria leer.

4. El modulo E/S le envia al CPU los bytes que el periferico le dejo. `I/O -> CPU`
5. Se guardan los bytes en la memoria. `CPU -> Memory`
6. Termino?
    * No: vuelve al inicio, al paso 1.
    * Si: pasa a la siguiente instruccion.

üü¢ Como ventaja esta la simplicidad del modelo.<br>
üî¥ Como desventaja tiene que que es una implementacion ineficiente ya que el CPU se queda esperando comprobando el estado del periferico sin hacer nada mas, entonces se desperdician recursos del procesador.

## E/S manejada por interrupciones
![aada](https://github.com/user-attachments/assets/3525bbe8-cdc2-4560-9f42-a5bce3f17b47) <br>

El CPU se entera que lo que le pidio al modulo E/S en algun momento ocurrio a traves de un componente del hardware del CPU que se identifica como Interrupcion, dedicado a escuchar esa se√±al de interrupcion para alertar  al CPU para que deje de hacer lo que esta haciendo, escuche esa interrupcion y la evalue.
1. Se envia el comando.
2. Se va a interrumpir al CPU cuando se reciba la se√±al de que se termino la operacion que se le habia pedido y vuelve para gestionar los datos que se recibieron.
     * Se identifica un erro -> se hace algo al respecto.
     * Se identifica un estado listo, se continua al siguiente paso.

Identico al modelo anterior       

3. El modulo E/S le envia al CPU los bytes que el periferico le dejo. `I/O -> CPU`
4. Se guardan los bytes en la memoria. `CPU -> Memory`
5. Termino?
    * No: vuelve al inicio, al paso 1.
    * Si: pasa a la siguiente instruccion.

üü¢ Como ventaja esta la mayor eficiencia comparado con el E/S programada, ya que la CPU no desperdicia ciclos de reloj esperando a que se complete la operaci√≥n de E/S.<br>
üî¥ El manejo frecuente de interrupciones puede afectar el rendimiento del sistema.

## Acceso directo a memoria (DMA)
![DMA](https://github.com/user-attachments/assets/9c23f02e-1e48-45e5-9089-1d2fc6793463) <br>
- El DMA es fisicamente otro circuito.<br>
- El DMA se encarga de capturar el estado del periferico, se encarga de que los bytes viajen desde el periferico al modulo DMA, lee los bytes, los escribe en memoria y cuando ya no hay mas que hacer se emite la Interrupcion que interrumpe al CPU. `DMA -> CPU`

üü¢ Libera al CPU de estar involucrada en la transferencia de datos, mejora significativamente la eficiencia del sistema. <br>
üî¥ Requiere hardware adicional (controlador DMA) y puede complicar el dise√±o del sistema. Adem√°s, el DMA puede competir con la CPU por el acceso a la memoria, lo que puede afectar el rendimiento.

### Informacion enviada por el CPU al DMA
El CPU envia:
- Operaci√≥n generica (READ o WRITE) v√≠a L√≠nea de Control.
- Direcci√≥n del dispositivo v√≠a L√≠nea de Direcci√≥n, ID guardada en el **address register**.
- Direcci√≥n inicial de memoria para READ o WRITE v√≠a L√≠nea de Datos, almacenado en el **address register**.
- Cantidad de memoria que se quiere LEER o ESCRIBIR, v√≠a L√≠nea de Datos, almacenado en el **data count register**

### Esquema del DMA
![esq](https://github.com/user-attachments/assets/fad3291e-7ac9-4fd4-885e-fab2153186a1) <br>
- **Data lines:**
     * **Data count:**
     * **Data register:** se almacenan temporalmente los datos que se transfieren entre el perif√©rico y la memoria. Utiliza l√≠neas de datos para transmitir la informaci√≥n.
     * **Address lines** -> **Address register:**  estos registros almacenan las direcciones de memoria tanto para la ubicaci√≥n de origen como para la ubicaci√≥n de destino de los datos que se est√°n transfiriendo.
- **Control logic:** corresponden a la linea de control
     * **Request to DMA:** Se√±al enviada por los dispositivos perif√©ricos para solicitar una transferencia de datos al DMA. Utilizan l√≠neas de direcciones para especificar estas ubicaciones
     * **Acknowledge from DMA:** Se√±al enviada por el DMA para confirmar que ha recibido la solicitud de transferencia de datos.
     * **Interrupt:** Se√±al enviada por el DMA a la CPU para notificar que la transferencia de datos ha sido completada o que se necesita atenci√≥n adicional.
     * **Read:** Se√±al enviada por el DMA para indicar que se debe leer datos desde el perif√©rico.
     * **Write:** Se√±al enviada por el DMA para indicar que se debe escribir datos en el perif√©rico.

#### Interaccion entre componentes
1. Cuando un dispositivo perif√©rico necesita transferir datos a la memoria, env√≠a una solicitud al DMA.
2. El DMA recibe la solicitud, la procesa y coordina la transferencia de datos, utilizando los registros de datos y direcciones seg√∫n sea necesario.
3. Una vez completada la transferencia, el DMA puede generar una interrupci√≥n para notificar a la CPU que la operaci√≥n ha finalizado.
4. La CPU puede luego acceder a los datos transferidos en la memoria o realizar otras tareas, mientras que el DMA est√° libre para procesar nuevas solicitudes de transferencia de datos.

### Robo de ciclos
El DMA requiere el uso de la memoria para poder leer o escribir.

Antes de la existencia del DMA, el acceso a la memoria era algo exclusivo del CPU, ahora hay que arbitrar, sincronizar el acceso a la memoria entre el CPU y DMA porque no podrian acceder a la memoria a la vez, por eso se articula el **"Robo de ciclos"** donde el DMA le indica al CPU que va a acceder a la memoria.

![a](https://github.com/user-attachments/assets/6d7eb10e-d796-4d92-92fd-9df2ca0ed2c9) <br>

El DMA puede acceder a la memoria durante los ciclos en los que el CPU no est√° utilizando la memoria activamente. Esto generalmente ocurre en momentos espec√≠ficos para evitar conflictos de acceso a la memoria. El DMA puede acceder a la memoria:
- Durante los ciclos de espera del CPU, cuando el CPU est√° esperando que se complete una operaci√≥n de E/S (Entrada/Salida) o est√° ejecutando instrucciones que no requieren acceso a la memoria.
- Cuando el CPU est√° realizando operaciones internas que no involucran la memoria, como c√°lculos dentro de su propio conjunto de registros.

El DMA puede acceder a la memoria cuando el CPU no este realizando operaciones criticas.

Y entre el ciclo de *store result* y *process interrupt* es cuando el CPU se pone a escuchar si hay algo que lo quiere interrumpir

### Topologias de configuracion 
**Configuraci√≥n basica (Un Bus Compartido) [Single-bus, detached DMA]:** 
-  Hay un √∫nico bus principal que es utilizado tanto por el CPU como por otros componentes del sistema, incluidos los dispositivos de entrada/salida (E/S) y la memoria.
-  En esta configuraci√≥n, el controlador de DMA est√° separado del CPU, actuando como un componente independiente que tambi√©n se conecta al bus principal. Esto simplifica el dise√±o del sistema pero puede llevar a congestiones en el bus si m√∫ltiples componentes intentan comunicarse simult√°neamente.
-  Tiene ineficiencias porque esta mezclando diferentes tr√°ficos de informaci√≥n en un mismo bus

![dddd](https://github.com/user-attachments/assets/c826595c-b656-4b37-854e-a087ca26d9d9)<br>

**Configuraci√≥n con DMA Integrado [Single-bus, integrated DMA-I/O]:**
- Los modulos de E/S cuelgan del DMA, acceden al bus a traves del DMA.
- Unico bus pero ahora los modulos E/S estan integrados con el DMA.
- Mejora la eficiencia al evitar el uso del bus principal para estas transferencias.

![efedf](https://github.com/user-attachments/assets/0e3455b3-6168-4474-9eab-9c5bdab50f57)<br>

**Configuraci√≥n con Bus Dedicado para E/S [I/O bus]:**
- La entrada/salida tiene un propio bus dedicado.
- Todo lo que es la conectividad del DMA con los modulos E/S ocurre a traves de ese bus dedicado.
  
![io](https://github.com/user-attachments/assets/2c3170a5-7760-4d93-b5ed-a6b6163557fa)


## Canales y procesadores de E/S
Para servidores o mainframes, se emplea una estrategia de gesti√≥n de entrada/salida m√°s avanzada mediante un componente llamado canal o procesador de entrada/salida.

Tecnologicamente son componentes mas complejos.

### Canales
Es un componente de harware, un circuite con una CPU propia:
- Tienen la habilidad de ejecutar instrucciones de E/S
- La CPU principal no ejecuta instrucciones de E/S
- Las instrucciones de E/S se almacenan en memoria principal
- La CPU le indica al canal de E/S que inicie un programa de canal, o sea una operacion de E/S que esta previamente programada. El CPU le indica:
   - Dispositivo que quiere realizar la operacion
   - √Årea de memoria destinada para el intercambio
   - Prioridad 
   - Acciones ante errores
#### Tipos de canales
- Selectores: usa un dispositivo a la vez a trav√©s de un controlador de E/S <br>
![sel](https://github.com/user-attachments/assets/3659b161-ce23-4b67-bcd6-599731f5fdd7) <br>

- Multiplexores: trabaja con m√∫ltiples dispositivos a la vez (multiplexa los flujos de datos) <br>
![eafdawd](https://github.com/user-attachments/assets/874cbcb6-6741-4214-a9aa-16a2468f4385)

### Procesadores
Agregan a los canales memoria propia en vez de usar la memoria principal.

